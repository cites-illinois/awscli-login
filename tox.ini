[tox]
envlist = py35,py36,py37,py38,py39

[testenv]
# getpass.getuser fails on Windows if these envs are not passed in
passenv = LOGNAME USER LNAME USERNAME
# https://packaging.python.org/guides/index-mirrors-and-caches/#caching-with-pip
install_command=python -m pip install --disable-pip-version-check --find-links=cache {opts} {packages}
commands = python -m unittest discover -s src {posargs}
# This is needed to ensure Github Action's caching will always work
alwayscopy = true
sitepackages = false

[testenv:{wheel,develop}]
deps = coverage
develop: usedevelop = true
extras = test
install_command=python -m pip install --no-index --find-links=cache {opts} {packages}
commands = {posargs:coverage run -m unittest discover -s src -v}

[testenv:{lint,static,coverage,report}]
skip_install = true
envdir={toxworkdir}/tools
deps = coverage
       flake8
       mypy
commands = lint: flake8 setup.py src/
           static: mypy setup.py src/
           coverage: coverage report --omit='*/.tox/*,tests/*' --fail-under 80
           report: coverage html
